# 操作系统


* [简述 Linux 内核态与用户态，什么时候会进入内核态？](#1)


------

### <span id="1">1.简述 Linux 内核态与用户态，什么时候会进入内核态？</span>
回答这道题的前提，需要先了解几个概念：虚拟地址空间和寻址、 内核空间和用户空间、内核态和用户态。
##### 虚拟地址空间和寻址
<details>
<summary>展开</summary>
以32位操作系统为例，它的寻址空间就是4G(2^32)。
寻址是指操作系统能找到的地址范围，32位的操作系统能找到的最大地址空间就是4G。
操作系统会给每个进程分配4G的虚拟内存空间，这个虚拟内存空间和真实内存空间之间有映射关系。
</details>

##### 内核空间和用户空间
<details>
<summary>展开</summary>
现代操作系统都会有内核，内核可以访问受保护的内存空间和访问底层硬件的权限，所以为了保证内核空间的安全。就需要区分内核空间和用户空间。
所以以4G的地址空间为例，内核空间拥有最上面的 1G 空间，用户空间拥有其余的3G空间。最高 1G 的内核空间是被所有进程共享的。
![](https://github.com/binbinshan/Review-Up/blob/master/images/网络协议/16239276614333.jpg)
也就是每个进程的 4G 地址空间中，最高 1G 都是一样的，即内核空间。只有剩余的 3G 才归进程自己使用。 
</details>

##### 内核态和用户态
<details>
<summary>展开</summary>
在理解了内核空间和用户空间之后，内核态和用户态就非常简单了。

当进程运行在内核空间时就处于内核态，而进程运行在用户空间时则处于用户态。
在内核态中，进程运行在内核空间中，此时CPU可以执行任何指令，运行代码也不受限制，可以访问任意内存空间。
在用户态中，进程运行在用户空间中，此时要受制CPU的各种限制，也只能访问用户态下可访问的虚拟空间地址。
</details>

##### 用户态怎么陷入内核态？
<details>
<summary>展开</summary>
主要是三个方面，会使用户态陷入内核态：
1. 系统调用：用户态进程通过系统调用申请使用操作系统提供的服务来完成任务，比如说读取磁盘上的一个文件，就会将用户态进程转为内核态。

2. 异常：当进程在用户态的执行过程中出现异常，此时就会由当前进程切换到内核中处理异常的服务中，也会将用户态进程转为内核态。
3. 外围设备中断：当外围设备完成用户请求的操作后，会向CPU发出相应的中断信号，比如说读取磁盘文件完成，系统会切换到中断处理后的后续操作，这个时候如果执行指令的进程处于用户态时，也会先切入到内核态。
</details>



